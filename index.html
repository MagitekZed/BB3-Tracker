<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BB3 League Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <h1>Blood Bowl 3 League Tracker</h1>
  
  <div class="nav-bar-container">
    <div id="breadcrumbs" class="breadcrumbs">Home</div>
    <div class="user-controls">
      <input type="password" id="editKeyInput" placeholder="Edit Key" />
      <button id="rememberKeyBtn" title="Save Key">ðŸ’¾</button>
    </div>
  </div>

  <div id="globalStatus" class="status"></div>

  <section id="leagueListSection">
    <div class="section-header">
      <h2>Leagues</h2>
      <button id="leagueCreateBtn" class="primary-btn">+ New League</button>
    </div>
    <div id="leagueListContainer"></div>
  </section>

  <section id="leagueViewSection" class="hidden">
    <div id="leagueHeader" class="page-header"></div>
    
    <div class="tabs">
      <button class="tab-btn active" onclick="switchLeagueTab('standings')">Standings</button>
      <button class="tab-btn" onclick="switchLeagueTab('matches')">Schedule</button>
      <button class="tab-btn" onclick="switchLeagueTab('admin')">Admin</button>
    </div>

    <div id="tab-standings" class="tab-content">
      <div id="standingsContainer"></div>
      <h3>Teams</h3>
      <div id="rosterQuickViewContainer"></div>
    </div>

    <div id="tab-matches" class="tab-content hidden">
      <div class="card">
        <h3>Schedule Match</h3>
        <div class="inline-input">
          <label>Rd: <input type="number" id="schedRound" value="1" style="width:40px"></label>
          <select id="schedHome"><option>Home...</option></select>
          <span style="font-weight:bold; color:#888;">vs</span>
          <select id="schedAway"><option>Away...</option></select>
          <button id="schedAddBtn" class="primary-btn">Add</button>
        </div>
      </div>
      <div id="inProgressContainer"></div>
      <div id="matchesContainer"></div>
    </div>

    <div id="tab-admin" class="tab-content hidden">
      <button id="leagueManageBtn" class="secondary-btn">Edit League Settings</button>
    </div>
  </section>

  <section id="leagueManageSection" class="hidden">
    <div class="card">
      <h2>Manage League</h2>
      <div class="form-grid">
        <div class="form-field"><label>ID</label><input id="leagueManageIdInput" readonly class="faded" /></div>
        <div class="form-field"><label>Name</label><input id="leagueManageNameInput" /></div>
        <div class="form-field"><label>Season</label><input type="number" id="leagueManageSeasonInput" /></div>
        <div class="form-field"><label>Status</label>
          <select id="leagueManageStatusSelect">
            <option value="upcoming">Upcoming</option>
            <option value="active">Active</option>
            <option value="completed">Completed</option>
          </select>
        </div>
        <div class="form-field">
          <label>Points (W/D/L)</label>
          <div style="display:flex; gap:5px">
            <input id="leagueManagePointsWinInput" type="number" placeholder="W" />
            <input id="leagueManagePointsDrawInput" type="number" placeholder="D" />
            <input id="leagueManagePointsLossInput" type="number" placeholder="L" />
          </div>
        </div>
      </div>
      <div class="button-group">
        <button id="leagueManageSaveBtn" class="primary-btn">Save League</button>
        <button id="leagueManageDeleteBtn" class="danger-btn">Delete League</button>
      </div>
    </div>
    <div class="card">
      <div class="card-header">
        <h3>Teams</h3>
        <button id="leagueManageAddTeamBtn" class="secondary-btn">+ Add Team</button>
      </div>
      <div id="leagueManageTeamsList"></div>
    </div>
  </section>

  <section id="teamViewSection" class="hidden">
    <div class="card team-header-card">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h2 id="teamHeaderName">Team Name</h2>
        <div id="teamTVBadge" class="tv-badge">TV: 1000k</div>
      </div>
      <div id="teamSummary" class="small"></div>
      <div style="margin-top:1rem;">
        <button id="teamEditBtn" class="secondary-btn">Edit / Manage Team</button>
      </div>
    </div>
    <div id="teamRosterContainer"></div>
  </section>

  <section id="teamEditorSection" class="hidden">
    <div class="card">
      <h2>Edit Team</h2>
      <div class="form-grid">
        <div class="form-field"><label>Name</label><input id="teamEditName" /></div>
        <div class="form-field"><label>Coach</label><input id="teamEditCoach" /></div>
        <div class="form-field"><label>Race</label><select id="teamEditRace" onchange="changeTeamRace(this.value)"></select></div>
        <div class="form-field"><label>Rerolls</label><input type="number" id="teamEditRerolls" style="width:60px" /></div>
        <div class="form-field"><label>Treasury (k)</label><input type="number" id="teamEditTreasury" /></div>
      </div>
      <div class="tv-bar" id="teamEditTVBar">Current TV: 0k</div>
    </div>

    <div class="card">
      <div class="card-header">
        <h3>Roster</h3>
        <button class="primary-btn" onclick="openShopModal()">+ Buy Player</button>
      </div>
      <table class="roster-editor-table">
        <thead><tr><th>#</th><th>Name</th><th>Pos</th><th>Stats</th><th>Skills</th><th>SPP</th><th></th></tr></thead>
        <tbody id="teamEditorRosterBody"></tbody>
      </table>
    </div>
    
    <div class="button-group">
      <button id="teamSaveBtn" class="primary-btn">Save Changes</button>
      <button id="teamDeleteBtn" class="danger-btn">Delete Team</button>
    </div>
  </section>

  <section id="preMatchSection" class="hidden">
    <h2>Match Setup</h2>
    <div class="versus-card">
      <div class="vs-team">
        <h3 id="pmHomeName">Home</h3>
        <div class="tv-display" id="pmHomeTV">TV 1000</div>
      </div>
      <div class="vs-divider">VS</div>
      <div class="vs-team">
        <h3 id="pmAwayName">Away</h3>
        <div class="tv-display" id="pmAwayTV">TV 1200</div>
      </div>
    </div>
    <div class="inducement-box">
      <h4>Inducements / Petty Cash</h4>
      <div id="pmInducementText">Home receives 200k gold.</div>
    </div>
    <button id="pmStartBtn" class="primary-btn full-width">START MATCH</button>
  </section>

  <section id="scoreboardSection" class="hidden">
    <div class="card">
      <div class="card-header">
        <h2>Live Match</h2>
        <div>
          <button id="sbRefreshBtn" class="secondary-btn">â†»</button>
        </div>
      </div>
      
      <div class="scoreboard-layout">
        <div class="team-control">
          <div id="sbHomeName" class="team-name">Home</div>
          <div id="sbHomeScore" class="score-display">0</div>
          <button class="primary-btn" onclick="enterCoachMode('home')">Coach Mode</button>
        </div>
        <div class="match-control">
          <div class="vs-tag">VS</div>
          <div class="turn-box">Turn: <span id="sbTurn">0</span></div>
          <button id="endGameBtn" class="primary-btn">End Game</button>
        </div>
        <div class="team-control">
          <div id="sbAwayName" class="team-name">Away</div>
          <div id="sbAwayScore" class="score-display">0</div>
          <button class="primary-btn" onclick="enterCoachMode('away')">Coach Mode</button>
        </div>
      </div>
    </div>
    <div class="scoreboard-rosters">
      <div class="roster-col"><h3>Home</h3><div id="sbHomeRoster"></div></div>
      <div class="roster-col"><h3>Away</h3><div id="sbAwayRoster"></div></div>
    </div>
  </section>

  <section id="coachSection" class="hidden">
    <div class="coach-header">
      <div class="coach-header-top">
        <div id="coachTeamName" class="coach-team-name">My Team</div>
        <div id="coachScoreDisplay" class="coach-score">0 - 0</div>
      </div>
      <div class="coach-resources">
        <div>Rerolls: <span id="coachRerolls" class="reroll-pips"></span></div>
        <div>Turn: <span id="coachTurnDisplay" style="font-weight:bold">0</span></div>
      </div>
    </div>

    <div id="coachRosterList" class="coach-card-grid"></div>

    <div class="coach-footer">
      <button class="secondary-btn" onclick="window.history.back()">Exit</button>
      <button class="primary-btn" id="coachEndTurnBtn">End Turn</button>
    </div>
  </section>

  <div id="confirmModal" class="modal hidden">
    <div class="modal-content">
      <h3>Confirm Action</h3>
      <p id="confirmText">Are you sure?</p>
      <input type="text" id="confirmInput" placeholder="Type name to confirm" class="hidden" />
      <div class="button-group" style="margin-top:1rem;">
        <button id="confirmBtn" class="danger-btn">Confirm</button>
        <button onclick="closeModal('confirmModal')" class="secondary-btn">Cancel</button>
      </div>
    </div>
  </div>

  <div id="shopModal" class="modal hidden">
    <div class="modal-content large">
      <div class="modal-header">
        <h3>Recruit Player</h3>
        <button class="close-btn" onclick="closeModal('shopModal')">Ã—</button>
      </div>
      <div id="shopContainer" class="shop-grid"></div>
    </div>
  </div>

  <div id="skillModal" class="modal hidden">
    <div class="modal-content">
      <h3 id="skillModalTitle">Skill</h3>
      <p id="skillModalBody"></p>
      <button onclick="closeModal('skillModal')" class="secondary-btn full-width">Close</button>
    </div>
  </div>

  <div id="actionSheet" class="action-sheet hidden">
    <div class="action-sheet-header">
      <h3 id="actionSheetTitle">Player Name</h3>
      <button onclick="closeActionSheet()">Ã—</button>
    </div>
    <div class="action-grid">
      <button class="big-action-btn td" onclick="doAction('td')">Touchdown</button>
      <button class="big-action-btn cas" onclick="doAction('cas')">Casualty (CAS)</button>
      <button class="big-action-btn int" onclick="doAction('int')">Interception</button>
      <button class="big-action-btn inj" onclick="doAction('inj')">Injury / KO</button>
      <button class="big-action-btn foul" onclick="doAction('sentOff')">Sent Off</button>
      <button class="big-action-btn mvp" onclick="doAction('mvp')">MVP</button>
    </div>
  </div>

  <div id="toast" class="toast hidden">Saving...</div>

  <datalist id="skillList"></datalist>
  <script src="app.js"></script>
</body>
</html>
