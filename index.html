<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BB3 League Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <header id="desktopHeader" class="desktop-only">
    <div class="header-row">
      <div class="brand">ğŸˆ BB3 Tracker</div>
      <div class="header-nav">
        <button id="navDeskLeagues" class="nav-link active">Leagues</button>
        <button id="navDeskAdmin" class="nav-link">Admin</button>
      </div>
      <div class="header-tools">
        <details class="key-details">
          <summary class="key-summary">ğŸ”‘ Edit Key</summary>
          <div class="key-dropdown">
            <input type="password" id="editKeyInput" placeholder="Enter Key..." />
            <button id="rememberKeyBtn" class="primary-btn">Save</button>
          </div>
        </details>
      </div>
    </div>
    <div id="breadcrumbs" class="breadcrumbs">
      <div class="breadcrumbs-inner"><span class="crumb">Home</span></div>
    </div>
  </header>

  <header id="mobileHeader" class="mobile-only">
    <div class="brand">ğŸˆ BB3 Tracker</div>
    <button id="mobileKeyToggle" class="icon-btn">ğŸ”‘</button>
  </header>
  
  <div id="mobileKeyModal" class="mobile-key-modal hidden">
    <div class="modal-content">
      <h3>ğŸ” Admin Access</h3>
      <p>Enter your League Edit Key:</p>
      <input type="password" id="mobileKeyInput" class="large-input" placeholder="Edit Key..." />
      <div class="modal-actions">
        <button id="mobileKeySaveBtn" class="primary-btn">Save & Close</button>
        <button onclick="document.getElementById('mobileKeyModal').classList.add('hidden')" class="secondary-btn">Cancel</button>
      </div>
    </div>
  </div>

  <div id="toastContainer"></div>

  <main id="mainContent">
    <section id="leagueListSection">
      <div class="page-header-panel">
        <h2>Leagues</h2>
        <div class="small">Select a league to view standings.</div>
      </div>
      <div style="margin: 1rem 0;">
        <button id="leagueCreateBtn" class="primary-btn">+ New League</button>
      </div>
      <div id="leagueListContainer"></div>
    </section>

    <section id="leagueViewSection" class="hidden">
      <div id="leagueHeader" class="page-header-panel"></div>
      
      <section id="leagueTeamsSection">
        <h3>Standings</h3>
        <div id="standingsContainer"></div>
        <div id="rosterQuickViewContainer" style="margin-top:1rem"></div>
      </section>

      <section id="leagueMatchesSection">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
          <h3>Matches</h3>
          <button id="desktopSchedBtn" class="primary-btn desktop-only">+ Schedule Match</button>
        </div>
        
        <div id="inProgressContainer"></div>
        <div id="matchesContainer"></div>
        
        <button id="mobileAddMatchBtn" class="fab-btn mobile-only">+</button>
      </section>
    </section>

    <section id="leagueManageSection" class="hidden">
       <div class="card"><div class="card-header"><h2 id="leagueManageHeader">Manage League</h2><button id="leagueManageBackBtn">â† Back</button></div><div id="leagueManageStatus"></div></div>
       <div id="leagueInfoCard" class="card">
         <div class="form-grid">
            <div class="form-field"><label>ID</label><input id="leagueManageIdInput"></div>
            <div class="form-field"><label>Name</label><input id="leagueManageNameInput"></div>
            <div class="form-field"><label>Season</label><input id="leagueManageSeasonInput" type="number"></div>
            <div class="form-field"><label>Status</label><select id="leagueManageStatusSelect"><option value="upcoming">Upcoming</option><option value="active">Active</option><option value="completed">Completed</option></select></div>
         </div>
         <div class="form-grid" style="margin-top:1rem">
            <div class="form-field"><label>Win Pts</label><input id="leagueManagePointsWinInput" type="number"></div>
            <div class="form-field"><label>Draw Pts</label><input id="leagueManagePointsDrawInput" type="number"></div>
            <div class="form-field"><label>Loss Pts</label><input id="leagueManagePointsLossInput" type="number"></div>
            <div class="form-field"><label>Max Teams</label><input id="leagueManageMaxTeamsInput" type="number"></div>
         </div>
         <div style="margin-top:1rem"><label><input id="leagueManageLockTeamsInput" type="checkbox"> Lock Teams</label></div>
       </div>
       <div id="leagueTeamsCard" class="card"><div id="leagueManageTeamsList"></div><button id="leagueManageAddNewTeamBtn">+ Team</button></div>
       <div id="teamEditorCard" class="card"><div id="leagueManageTeamEditor"></div></div>
       <div class="card"><button id="leagueManageSaveBtn" class="primary-btn">Save Changes</button><div id="deleteLeagueContainer"></div></div>
    </section>

    <section id="teamViewSection" class="hidden">
       <div class="card">
        <div class="card-header" id="teamViewHeaderContainer"><h2 id="teamHeader">Team</h2><div><button id="teamBackBtn">â† Back</button> <button id="teamManageBtn">Manage</button></div></div>
        <div id="teamSummary"></div>
      </div>
      <div id="teamRosterContainer"></div>
    </section>

    <section id="scoreboardSection" class="hidden">
      <div class="card">
        <div class="card-header"><h2>Live Match</h2><div><button id="scoreboardRefreshBtn">â†»</button><button id="scoreboardBackToMatchBtn">Exit</button></div></div>
        <div class="scoreboard-layout">
           <div class="team-control">
             <div id="sbHomeName">Home</div>
             <div id="sbHomeScore" class="score-display">0</div>
             <div class="turn-box">Turn: <span id="sbHomeTurn">0</span></div>
             <div style="margin-top:0.5rem"><button class="primary-btn" onclick="enterCoachMode('home')">Play as Home</button></div>
           </div>
           <div class="match-control"><button id="endGameBtn" class="primary-btn">End Game</button><button id="cancelGameBtn" class="danger-btn" style="margin-top:1rem">Cancel</button></div>
           <div class="team-control">
             <div id="sbAwayName">Away</div>
             <div id="sbAwayScore" class="score-display">0</div>
             <div class="turn-box">Turn: <span id="sbAwayTurn">0</span></div>
             <div style="margin-top:0.5rem"><button class="primary-btn" onclick="enterCoachMode('away')">Play as Away</button></div>
           </div>
        </div>
      </div>
      <div class="scoreboard-rosters"><div id="scoreboardHomeRoster"></div><div id="scoreboardAwayRoster"></div></div>
    </section>

    <section id="coachSection" class="hidden">
      <div class="coach-header">
        <div class="coach-header-row1"><div class="coach-team-name" id="coachTeamName">My Team</div></div>
        <div class="coach-header-row2">
           <div class="coach-score" id="coachScoreDisplay">0-0</div>
           <div class="coach-resources"><div id="coachRerolls"></div><span id="coachTurnDisplay">Turn: 0</span></div>
        </div>
      </div>
      <div id="coachRosterList"></div>
      <div class="coach-footer"><button class="secondary-btn" onclick="exitCoachMode()">Exit</button><button class="primary-btn" id="coachEndTurnBtn">End Turn</button></div>
    </section>

    <section id="adminSection" class="hidden">
      <h2>Admin Tools</h2>
      <div class="card">
        <h3>Repository Health</h3>
        <button id="scanBtn">Scan Repository</button>
        <div id="scanResults"></div>
      </div>
      <div class="card">
        <h3>Raw JSON</h3>
        <textarea id="leagueTextarea" style="width:100%; height:200px"></textarea>
        <button id="loadBtn">Load</button> <button id="saveBtn">Save</button>
      </div>
    </section>

  </main>

  <nav id="mobileNavBar" class="mobile-only">
    <button id="navMobLeagues" class="tab-btn active"><span class="tab-icon">ğŸ†</span><span class="tab-label">Leagues</span></button>
    <button id="navMobMatch" class="tab-btn"><span class="tab-icon">âš”ï¸</span><span class="tab-label">Match</span></button>
    <button id="navMobAdmin" class="tab-btn"><span class="tab-icon">âš™ï¸</span><span class="tab-label">Admin</span></button>
  </nav>

  <div id="scheduleModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header"><h3>Schedule Match</h3><button class="close-btn" onclick="closeScheduleModal()">Ã—</button></div>
      <div class="form-grid">
        <div class="form-field"><label>Round</label><input type="number" id="schedModalRound" value="1"></div>
        <div class="form-field"><label>Home Team</label><select id="schedModalHome"></select></div>
        <div class="form-field"><label>Away Team</label><select id="schedModalAway"></select></div>
      </div>
      <div class="modal-actions" style="margin-top:1.5rem">
        <button onclick="closeScheduleModal()" class="secondary-btn">Cancel</button>
        <button id="schedModalAddBtn" class="primary-btn">Schedule Match</button>
      </div>
    </div>
  </div>

  <div id="playerActionSheet" class="action-sheet hidden">
    <div class="action-sheet-backdrop" onclick="closeActionSheet()"></div>
    <div class="action-sheet-content">
      <div class="action-sheet-header">
        <h3 id="actionSheetTitle">Player Name</h3>
        <button class="close-btn" onclick="closeActionSheet()">Ã—</button>
      </div>
      <div class="sheet-grid">
        <button class="sheet-btn btn-td" onclick="handleSheetAction('td')">
          <div class="emoji">ğŸˆ</div> Touchdown
        </button>
        <button class="sheet-btn btn-cas" onclick="handleSheetAction('cas')">
          <div class="emoji">ğŸ’¥</div> Casualty
        </button>
        <button class="sheet-btn btn-inj" onclick="handleSheetAction('injured')">
          <div class="emoji">ğŸ¤•</div> Injury
        </button>
         <button class="sheet-btn btn-used" onclick="handleSheetAction('used')">
          <div class="emoji">ğŸ’¤</div> Toggle Used
        </button>
      </div>
    </div>
  </div>

  <div id="skillModal" class="modal hidden">
    <div class="modal-content"><div class="modal-header"><h3 id="skillModalTitle"></h3><button class="close-btn" onclick="closeSkillModal()">Ã—</button></div><div id="skillModalBody"></div></div>
  </div>
  <datalist id="skillList"></datalist>

  <script src="app.js"></script>
</body>
</html>
