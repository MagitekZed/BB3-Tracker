<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BB3 League Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <header id="desktopHeader" class="desktop-only">
    <div class="header-row">
      <div class="brand">üèà BB3 Tracker</div>
      <div class="header-nav">
        <button id="navDeskLeagues" class="nav-link active">Leagues</button>
        <button id="navDeskAdmin" class="nav-link">Admin</button>
      </div>
      <div class="header-tools">
        <details class="key-details">
          <summary class="key-summary">üîë Edit Key</summary>
          <div class="key-dropdown">
            <input type="password" id="editKeyInput" placeholder="Enter Key..." />
            <button id="rememberKeyBtn" class="primary-btn">Save</button>
          </div>
        </details>
      </div>
    </div>
    <div id="breadcrumbs" class="breadcrumbs">
      <div class="breadcrumbs-inner"><span class="crumb">Home</span></div>
    </div>
  </header>

  <header id="mobileHeader" class="mobile-only">
    <div class="brand">üèà BB3 Tracker</div>
    <button id="mobileKeyToggle" class="icon-btn">üîë</button>
  </header>
  
  <div id="mobileKeyModal" class="mobile-key-modal hidden">
    <div class="modal-content">
      <h3>üîê Admin Access</h3>
      <p>Enter your League Edit Key:</p>
      <input type="password" id="mobileKeyInput" class="large-input" placeholder="Edit Key..." />
      <div class="modal-actions">
        <button id="mobileKeySaveBtn" class="primary-btn">Save & Close</button>
        <button onclick="document.getElementById('mobileKeyModal').classList.add('hidden')" class="secondary-btn">Cancel</button>
      </div>
    </div>
  </div>

  <div id="toastContainer"></div>

  <main id="mainContent">
    <section id="leagueListSection">
      <div class="page-header-panel">
        <h2>Leagues</h2>
        <div class="small">Select a league to view standings.</div>
      </div>
      <div style="margin: 1rem 0;">
        <button id="leagueCreateBtn" class="primary-btn">+ New League</button>
      </div>
      <div id="leagueListContainer"></div>
    </section>

    <section id="leagueViewSection" class="hidden">
      <div id="leagueHeader" class="page-header-panel"></div>
      
      <section id="leagueTeamsSection">
        <h3>Standings</h3>
        <div id="standingsContainer"></div>
        <div id="rosterQuickViewContainer" style="margin-top:1rem"></div>
      </section>

      <section id="leagueMatchesSection">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
          <h3>Matches</h3>
          <button id="desktopSchedBtn" class="primary-btn desktop-only">+ Schedule Match</button>
        </div>
        
        <div id="inProgressContainer"></div>
        <div id="matchesContainer"></div>
        
        <button id="mobileAddMatchBtn" class="fab-btn mobile-only">+</button>
      </section>
    </section>

    <section id="leagueManageSection" class="hidden">
       <div class="card"><div class="card-header"><h2 id="leagueManageHeader">Manage League</h2><button id="leagueManageBackBtn">‚Üê Back</button></div><div id="leagueManageStatus"></div></div>
       <div id="leagueInfoCard" class="card">
         <div class="form-grid">
            <div class="form-field"><label>ID</label><input id="leagueManageIdInput"></div>
            <div class="form-field"><label>Name</label><input id="leagueManageNameInput"></div>
            <div class="form-field"><label>Season</label><input id="leagueManageSeasonInput" type="number"></div>
            <div class="form-field"><label>Status</label><select id="leagueManageStatusSelect"><option value="upcoming">Upcoming</option><option value="active">Active</option><option value="completed">Completed</option></select></div>
         </div>
         <div class="form-grid" style="margin-top:1rem">
            <div class="form-field"><label>Win Pts</label><input id="leagueManagePointsWinInput" type="number"></div>
            <div class="form-field"><label>Draw Pts</label><input id="leagueManagePointsDrawInput" type="number"></div>
            <div class="form-field"><label>Loss Pts</label><input id="leagueManagePointsLossInput" type="number"></div>
            <div class="form-field"><label>Max Teams</label><input id="leagueManageMaxTeamsInput" type="number"></div>
         </div>
         <div style="margin-top:1rem"><label><input id="leagueManageLockTeamsInput" type="checkbox"> Lock Teams</label></div>
       </div>
       <div id="leagueTeamsCard" class="card"><div id="leagueManageTeamsList"></div><button id="leagueManageAddNewTeamBtn">+ Team</button></div>
       <div id="teamEditorCard" class="card"><div id="leagueManageTeamEditor"></div></div>
       <div class="card"><button id="leagueManageSaveBtn" class="primary-btn">Save Changes</button><div id="deleteLeagueContainer"></div></div>
    </section>

    <section id="teamViewSection" class="hidden">
       <div class="card">
        <div class="card-header" id="teamViewHeaderContainer"><h2 id="teamHeader">Team</h2><div><button id="teamBackBtn">‚Üê Back</button> <button id="teamManageBtn">Manage</button></div></div>
        <div id="teamSummary"></div>
      </div>
      <div id="teamRosterContainer"></div>
    </section>

    <section id="scoreboardSection" class="hidden">
      <div class="card">
        <div class="card-header"><h2>Live Match</h2><div><button id="scoreboardRefreshBtn">‚Üª</button><button id="scoreboardBackToMatchBtn">Exit</button></div></div>
        <div class="scoreboard-layout">
           <div class="team-control">
             <div id="sbHomeName">Home</div>
             <div id="sbHomeScore" class="score-display">0</div>
             <div class="turn-box">Turn: <span id="sbHomeTurn">0</span></div>
             <div style="margin-top:0.5rem"><button class="primary-btn" onclick="enterCoachMode('home')">Play as Home</button></div>
           </div>
           <div class="match-control"><button id="endGameBtn" class="primary-btn">End Game</button><button id="cancelGameBtn" class="danger-btn" style="margin-top:1rem">Cancel</button></div>
           <div class="team-control">
             <div id="sbAwayName">Away</div>
             <div id="sbAwayScore" class="score-display">0</div>
             <div class="turn-box">Turn: <span id="sbAwayTurn">0</span></div>
             <div style="margin-top:0.5rem"><button class="primary-btn" onclick="enterCoachMode('away')">Play as Away</button></div>
           </div>
        </div>
      </div>
      <div class="scoreboard-rosters"><div id="scoreboardHomeRoster"></div><div id="scoreboardAwayRoster"></div></div>
    </section>

    <section id="coachSection" class="hidden">
      <div class="coach-header">
        <div class="coach-header-row1"><div class="coach-team-name" id="coachTeamName">My Team</div></div>
        <div class="coach-header-row2">
           <div class="coach-score" id="coachScoreDisplay">0-0</div>
           <div class="coach-resources"><div id="coachRerolls"></div><span id="coachTurnDisplay">Turn: 0</span></div>
        </div>
      </div>
      <div id="coachRosterList"></div>
      <div class="coach-footer"><button class="secondary-btn" onclick="exitCoachMode()">Exit</button><button class="primary-btn" id="coachEndTurnBtn">End Turn</button></div>
    </section>

    <section id="adminSection" class="hidden">
      <h2>Admin Tools</h2>
      <div class="card">
        <h3>Repository Health</h3>
        <button id="scanBtn">Scan Repository</button>
        <div id="scanResults"></div>
      </div>
      <div class="card">
        <h3>Raw JSON</h3>
        <textarea id="leagueTextarea" style="width:100%; height:200px"></textarea>
        <button id="loadBtn">Load</button> <button id="saveBtn">Save</button>
      </div>
    </section>

  </main>

  <nav id="mobileNavBar" class="mobile-only">
    <button id="navMobLeagues" class="tab-btn active"><span class="tab-icon">üèÜ</span><span class="tab-label">Leagues</span></button>
    <button id="navMobMatch" class="tab-btn"><span class="tab-icon">‚öîÔ∏è</span><span class="tab-label">Match</span></button>
    <button id="navMobAdmin" class="tab-btn"><span class="tab-icon">‚öôÔ∏è</span><span class="tab-label">Admin</span></button>
  </nav>

  <div id="scheduleModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header"><h3>Schedule Match</h3><button class="close-btn" onclick="closeScheduleModal()">√ó</button></div>
      <div class="form-grid">
        <div class="form-field"><label>Round</label><input type="number" id="schedModalRound" value="1"></div>
        <div class="form-field"><label>Home Team</label><select id="schedModalHome"></select></div>
        <div class="form-field"><label>Away Team</label><select id="schedModalAway"></select></div>
      </div>
      <div class="modal-actions" style="margin-top:1.5rem">
        <button onclick="closeScheduleModal()" class="secondary-btn">Cancel</button>
        <button id="schedModalAddBtn" class="primary-btn">Schedule Match</button>
      </div>
    </div>
  </div>

  <div id="preMatchModal" class="modal hidden" style="z-index: 2500;">
    <div class="modal-content" style="max-width: 800px; width: 95%;">
      <div class="modal-header"><h3>Match Setup & Inducements</h3><button class="close-btn" onclick="closePreMatchModal()">√ó</button></div>
      
      <div class="card" style="margin-bottom:1rem; background:#eee;">
         <div style="display:flex; justify-content:space-between; align-items:center;">
            <div style="text-align:center; flex:1">
               <h4 id="pmHomeName" style="margin:0; color:var(--primary-red)">Home</h4>
               <div id="pmHomeTV" style="font-weight:bold; font-size:1.2rem">0k</div>
            </div>
            <div style="font-weight:bold; color:#666">VS</div>
            <div style="text-align:center; flex:1">
               <h4 id="pmAwayName" style="margin:0; color:var(--primary-red)">Away</h4>
               <div id="pmAwayTV" style="font-weight:bold; font-size:1.2rem">0k</div>
            </div>
         </div>
      </div>

      <div class="modal-body-scroll">
        <div class="sheet-grid pre-match-grid">
           <!-- Home Shop -->
           <div class="panel-styled" style="padding:0.5rem;">
              <div style="border-bottom:2px solid #ccc; padding-bottom:0.5rem; margin-bottom:0.5rem; text-align:center;">
                 <strong>Home Budget</strong>
                 <div style="display:flex; justify-content:space-between; font-size:0.9rem; margin-top:0.25rem;">
                   <span>Treasury: <span id="pmHomeBank">0</span>k</span>
                   <span style="color:green">Petty: <span id="pmHomePetty">0</span>k</span>
                 </div>
                 <div style="font-weight:bold; margin-top:0.25rem;">Spend Cap: <span id="pmHomeTotal">0</span>k</div>
                 <div class="small" id="pmHomeCtvLine" style="margin-top:0.25rem; color:#444;">CTV: <span id="pmHomeCtv">0</span>k ‚Ä¢ Players: <span id="pmHomeAvail">0</span>+<span id="pmHomeJourneys">0</span>J</div>
              </div>
              <div id="pmHomeInducements"></div>
              <div style="margin-top:0.5rem; font-size:0.85rem; color:#444">
                 <strong>Spent:</strong> <span id="pmHomeSpent">0</span>k 
                 <span id="pmHomeOver" style="color:red; font-weight:bold; display:none;">(OVER BUDGET)</span>
              </div>
           </div>

           <!-- Away Shop -->
           <div class="panel-styled" style="padding:0.5rem;">
              <div style="border-bottom:2px solid #ccc; padding-bottom:0.5rem; margin-bottom:0.5rem; text-align:center;">
                 <strong>Away Budget</strong>
                 <div style="display:flex; justify-content:space-between; font-size:0.9rem; margin-top:0.25rem;">
                   <span>Treasury: <span id="pmAwayBank">0</span>k</span>
                   <span style="color:green">Petty: <span id="pmAwayPetty">0</span>k</span>
                 </div>
                 <div style="font-weight:bold; margin-top:0.25rem;">Spend Cap: <span id="pmAwayTotal">0</span>k</div>
                 <div class="small" id="pmAwayCtvLine" style="margin-top:0.25rem; color:#444;">CTV: <span id="pmAwayCtv">0</span>k ‚Ä¢ Players: <span id="pmAwayAvail">0</span>+<span id="pmAwayJourneys">0</span>J</div>
              </div>
              <div id="pmAwayInducements"></div>
              <div style="margin-top:0.5rem; font-size:0.85rem; color:#444">
                 <strong>Spent:</strong> <span id="pmAwaySpent">0</span>k 
                 <span id="pmAwayOver" style="color:red; font-weight:bold; display:none;">(OVER BUDGET)</span>
              </div>
           </div>
        </div>
      </div>
      
      <div class="modal-actions" style="margin-top:1rem; border-top:1px solid #ccc; padding-top:1rem;">
        <button onclick="closePreMatchModal()" class="secondary-btn">Cancel</button>
        <button id="pmStartBtn" class="primary-btn">Confirm & Play Ball!</button>
      </div>
    </div>
  </div>

  <div id="postGameModal" class="modal hidden" style="z-index: 4000;">
    <div class="modal-content" style="max-width: 600px; width: 95%;">
        <div class="modal-header"><h3>Post-Game Report</h3></div>
        <div id="postGameBody" class="modal-body-scroll"></div>
        <div class="modal-actions" style="margin-top:1rem; padding-top:1rem; border-top:1px solid #ccc; justify-content: space-between;">
            <button id="pgBackBtn" class="secondary-btn">Back</button>
            <button id="pgNextBtn" class="primary-btn">Next</button>
        </div>
    </div>
  </div>

  <div id="playerActionSheet" class="action-sheet hidden">
    <div class="action-sheet-backdrop" onclick="closeActionSheet()"></div>
    <div class="action-sheet-content">
      <div class="action-sheet-header">
        <h3 id="actionSheetTitle">Player Name</h3>
        <button class="close-btn" onclick="closeActionSheet()">√ó</button>
      </div>
      <!-- Stat Grid injected by JS -->
    </div>
  </div>

  <div id="skillModal" class="modal hidden">
    <div class="modal-content"><div class="modal-header"><h3 id="skillModalTitle"></h3><button class="close-btn" onclick="closeSkillModal()">√ó</button></div><div id="skillModalBody"></div></div>
  </div>
  <datalist id="skillList"></datalist>

  <!-- LOAD THE MODULAR APP ENTRY POINT -->
  <script type="module" src="js/app.js"></script>
</body>
</html>
